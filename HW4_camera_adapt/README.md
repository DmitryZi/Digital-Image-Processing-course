## Задание 4

### Постановка задачи

На вход подается изображение с незаполненной доской судоку. Требуется:

1. Выявить **контур** доски на изображении.
2. Построить матрицу для **калибровки** изображения: после калибровки должен получиться "вид сверху" на судоку. Выполнить калибровку камеры.
3. Определить пустые и заполненные числами ячейки: использовать **шаблоны цифр** для определения значения ячейки.
4. Решить судоку.
5. Заполнить числами из решения исходное изображение: числа должны располагаться в ячейках и искажены согласно положению судоку на изображении.

### Решение задачи
0. Рассмотрим следующее входное изображение:

    <img src="examples/6.jpg" alt="orig"  width="400" />


1. Входное изображение преобразуется: конвертируется в чб, удаляется шум, с помощью опорных шаблонов восстанавливаются элементы сетки:

    <img src="readme_src/after_preprocess.png" alt="preprocess"  width="400" />

2. Выполняется поиск контуров. Контуры сортируются по площади и анализируются: аппроксимируются многоугольником. Задача обнаружить большой четырехугольник. Самый подходящий считается границей доски судоку.

    <img src="readme_src/all_contours.png" alt="all_contours"  width="400" />
    <img src="readme_src/board_contour.png" alt="board_contour"  width="400" />

3. Полученные углы четырехугольника используются для калибровки камеры: получается вид сверху, где углы доски - углы изображения.

    <img src="readme_src/calibrated.png" alt="calibrated"  width="400" />

4. Изображение делится на 81 часть, в каждой ячейке определяется цифра (или пустота). Число определяется путем применение шаблона: т.к. размер ячейки в пикселях определяется достаточно точно, то можно удобно масштабировать шаблон и не искать его с учетом гомотетии. Примеры вырезанных ячеек и найденных цифр:

    <img src="readme_src/template_match.png" alt="template_match"  width="400" />
    <img src="readme_src/template_match2.png" alt="template_match2"  width="400" />

5. Обнаруженные цифры заносятся в таблицу для решения судоку. После зполнения сама судоку решается стандартным рекурсивным методом.

    <img src="readme_src/before_solve_grid.png" alt="before_solve_grid"  width="400" />
    <img src="readme_src/after_solve_grid.png" alt="after_solve_grid"  width="400" />

6. Полученные числа печатаются на трансформированном изображении. Затем, т.к. известно прямое калибровочное отображение, можно построить обратное отображение и "вклеить" доску обратно.

    <img src="readme_src/solved.png" alt="solved"  width="400" />

### Примеры

<img src="examples/2.jpg" alt="ex_2"  width="400" />
<img src="readme_src/solved_2.png" alt="res_2"  width="400" />

<img src="examples/4.jpg" alt="ex_4"  width="400" />
<img src="readme_src/solved_4.png" alt="res_4"  width="400" />

<img src="examples/7.jpg" alt="ex_7"  width="400" />
<img src="readme_src/solved_7.png" alt="res_7"  width="400" />

<img src="examples/8.jpg" alt="ex_8"  width="400" />
<img src="readme_src/solved_8.png" alt="res_8"  width="400" />

### Реализованные требования:

1. Поиск и обработка контуров, учет морфологии объекта.
2. Калибровка камеры, прямое и обратное преобразование по опорным точкам.
3. Поиск шаблона в выбранном изображении, учет соотношения размеров.